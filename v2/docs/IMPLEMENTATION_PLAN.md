# URL ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰åŒ– å®Ÿè£…è¨ˆç”»

**å®Ÿè£…æ—¥**: 2025-12-17

## ğŸ¯ å®Ÿè£…ç›®æ¨™

Bluesky æŠ•ç¨¿æ™‚ã«ã€**embed ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ Union å‹ï¼ˆ1ç¨®é¡ã®ã¿ï¼‰** ã¨ã„ã†åˆ¶é™ã‚’è€ƒæ…®ã—ãŸä»¥ä¸‹ã®æ¡ä»¶åˆ†å²ã‚’å®Ÿè£…ã™ã‚‹ã€‚

---

## ğŸ“Š æ¡ä»¶åˆ†å²è¡¨

| çŠ¶æ…‹ | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ | ç”»åƒæŠ•ç¨¿ | ãƒ†ã‚­ã‚¹ãƒˆ | URL ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯ | ç”»åƒ embed | ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ embed |
|------|-----------|---------|--------|------------------|-----------|------------------|
| **1** | âŒ ãªã— | N/A | âœ… | âœ… | âŒ | âœ… |
| **2** | âœ… ã‚ã‚Š | æœ‰åŠ¹ | âœ… | âœ… | âœ… | âŒ |
| **3** | âœ… ã‚ã‚Š | ç„¡åŠ¹ | âœ… | âœ… | âŒ | âœ… |

---

## 1ï¸âƒ£ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç„¡ã—ã®å ´åˆ

**ãƒ‘ã‚¿ãƒ¼ãƒ³**: ã‚³ã‚¢æ©Ÿèƒ½ã§ç›´æ¥æŠ•ç¨¿

```
ãƒ†ã‚­ã‚¹ãƒˆæŠ•ç¨¿
â”œâ”€ URLã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯åŒ–ï¼ˆFacetï¼‰
â””â”€ URLã‚’ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã¨ã—ã¦åŸ‹ã‚è¾¼ã¿ï¼ˆexternal embedï¼‰
```

### å®Ÿè£…å†…å®¹

- `bluesky_v2.py` ã« OGP å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- `bluesky_v2.py` ã«å¤–éƒ¨ embed æ§‹ç¯‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- `post_video_minimal()` ã§ `use_link_card=True` ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«

### ã‚³ãƒ¼ãƒ‰ä¾‹

```python
def post_video_minimal(self, video: dict) -> bool:
    # ...
    use_link_card = video.get("use_link_card", True)  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: True

    if use_link_card:
        embed = self._build_external_embed(video_url)
    else:
        embed = video.get("embed")

    # embed ã‚’ post_record ã«è¿½åŠ 
```

---

## 2ï¸âƒ£ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚ã‚Š + ç”»åƒæŠ•ç¨¿æœ‰åŠ¹

**ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµŒç”±ã§æŠ•ç¨¿ï¼ˆç”»åƒå„ªå…ˆï¼‰

```
ãƒ†ã‚­ã‚¹ãƒˆæŠ•ç¨¿
â”œâ”€ URLã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯åŒ–ï¼ˆFacetï¼‰
â””â”€ ç”»åƒã‚’ embed ã¨ã—ã¦åŸ‹ã‚è¾¼ã¿ï¼ˆimages embedï¼‰
   â†“
   ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã¯ã€Œä½¿ç”¨ã—ãªã„ã€
```

### å®Ÿè£…å†…å®¹

- `bluesky_plugin.py` ã® `post_video()` ã§ `use_link_card=False` ã‚’è¨­å®š
- ç”»åƒãŒå­˜åœ¨ã™ã‚‹å ´åˆã€`embed` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç”»åƒã‚’è¨­å®š

### ã‚³ãƒ¼ãƒ‰ä¾‹

```python
def post_video(self, video: dict) -> bool:
    # ... ç”»åƒå‡¦ç† ...

    if embed:  # ç”»åƒãŒã‚ã‚‹å ´åˆ
        video["embed"] = embed
        video["use_link_card"] = False  # ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–

    return self.minimal_poster.post_video_minimal(video)
```

---

## 3ï¸âƒ£ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚ã‚Š + ç”»åƒæŠ•ç¨¿ç„¡åŠ¹

**ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³çµŒç”±ã§æŠ•ç¨¿ï¼ˆãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰æœ‰åŠ¹ï¼‰

```
ãƒ†ã‚­ã‚¹ãƒˆæŠ•ç¨¿
â”œâ”€ URLã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯åŒ–ï¼ˆFacetï¼‰
â””â”€ URLã‚’ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã¨ã—ã¦åŸ‹ã‚è¾¼ã¿ï¼ˆexternal embedï¼‰
   â†“
   ç”»åƒ embed ã¯ã€Œä½¿ç”¨ã—ãªã„ã€
```

### å®Ÿè£…å†…å®¹

- `bluesky_plugin.py` ã® `post_video()` ã§ç”»åƒãŒç„¡ã„å ´åˆã€`use_link_card=True` ã‚’è¨­å®š

### ã‚³ãƒ¼ãƒ‰ä¾‹

```python
def post_video(self, video: dict) -> bool:
    # ... ç”»åƒå‡¦ç† ...

    if not embed:  # ç”»åƒãŒãªã„å ´åˆ
        video["use_link_card"] = True  # ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
    else:
        video["use_link_card"] = False

    return self.minimal_poster.post_video_minimal(video)
```

---

## ğŸ”§ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ—1: bluesky_v2.py æ‹¡å¼µ

- `_build_external_embed()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
  - å…¥åŠ›: URL
  - å‡ºåŠ›: `app.bsky.embed.external` embed ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

- `_fetch_ogp_data()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
  - å…¥åŠ›: URL
  - å‡ºåŠ›: OGP ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€ç”»åƒ URLï¼‰

- `_upload_blob()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆOGP ç”»åƒç”¨ï¼‰
  - å…¥åŠ›: ç”»åƒ URL
  - å‡ºåŠ›: Blob ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

### ã‚¹ãƒ†ãƒƒãƒ—2: post_video_minimal() ä¿®æ­£

- `use_link_card` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ã‚’è¿½åŠ 
- `use_link_card=True` ã®å ´åˆã€OGP ã‹ã‚‰ embed ã‚’æ§‹ç¯‰

### ã‚¹ãƒ†ãƒƒãƒ—3: bluesky_plugin.py ä¿®æ­£

- `post_video()` ã§ç”»åƒæœ‰ç„¡ã«å¿œã˜ã¦ `use_link_card` ãƒ•ãƒ©ã‚°ã‚’è¨­å®š

---

## âš ï¸ æ³¨æ„ç‚¹

### embed ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ Union å‹

```json
// âŒ è¤‡æ•°ã® embed ã‚’åŒæ™‚ã«æŒã¤ã“ã¨ã¯ã§ããªã„
{
  "embed": {
    "$type": "app.bsky.embed.images"   // ç”»åƒ
  },
  "embed": {
    "$type": "app.bsky.embed.external"  // ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ï¼ˆé‡è¤‡ã®ãŸã‚ä¸å¯ï¼‰
  }
}

// âœ… 1ã¤ã®ã¿
{
  "embed": {
    "$type": "app.bsky.embed.external"
  }
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- OGP å–å¾—å¤±æ•—æ™‚: ãƒ­ã‚°å‡ºåŠ›ã—ã¦ embed ãªã—ã§æŠ•ç¨¿
- ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚: ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ï¼ˆç”»åƒãªã—ï¼‰

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] OGP å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ embed æ§‹ç¯‰ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] post_video_minimal() ã«æ¡ä»¶åˆ†å²è¿½åŠ 
- [ ] bluesky_plugin.py ã« use_link_card ãƒ•ãƒ©ã‚°è¿½åŠ 
- [ ] ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³å¯¾å¿œ
- [ ] ãƒ­ã‚°å‡ºåŠ›ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿæ–½

---

## ğŸ“š å‚è€ƒè³‡æ–™

- `BLUESKY_PLUGIN_GUIDE.md`: Rich Text Facet å®Ÿè£…
- `bluesky-link-card-guide.md`: ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰è©³ç´°ä»•æ§˜
- Bluesky API å…¬å¼: https://docs.bsky.app/docs/advanced-guides/posts
