# Streamnotify on Bluesky - v3.3.0 リリースノート

**リリース日**: 2025年12月19日
**最終更新**: 2026年1月7日（v3.3.3 対応）

## 新機能

### 🎯 4条件の複合フィルタリング
v3.3.0 で **高度なフィルタリング機能** が完成しました。

**対応フィルタ条件**:
- **タイトル検索**: リアルタイム、部分一致、大文字小文字区別なし
- **投稿状態**: 全て / 投稿済み / 未投稿
- **配信元**: 全て / YouTube / Niconico
- **コンテンツタイプ**: 7種類（🎬 動画 / 📹 アーカイブ / 🔴 放送予約 / 🔴 放送中 / ⏹️ 放送終了 / ✨ プレミア）

**使い方**:
- 4つの条件を **AND で結合**
- フィルタ結果の件数をステータスバーに表示
- 🔄 リセットボタンで一括クリア

### 🛑 重複投稿防止オプション
誤った再投稿を自動防止します。

- **設定**: `PREVENT_DUPLICATE_POSTS = true` （デフォルト: false）
- **動作**: 投稿前に自動チェック
- **検知時**: 警告メッセージを表示して投稿中止
- **ログ**: 重複検知時に ⚠️ 警告マークで記録

### ✅ テンプレート処理完全実装
Jinja2 テンプレートエンジンで **動的なテンプレート** に完全対応。

**対応機能**:
- **動的変数**: `{{ current_date }}`, `{{ current_time }}`, `{{ day_of_week }}` など
- **条件分岐**: サービス別・イベント別の自動選択
- **フォールバック**: テンプレート未設定時の自動フォールバック
- **複数フィルター**: 動画ソース・動画タイプごとの条件判定

**対応テンプレート**:
| サービス | タイプ | テンプレート | 対応状況 |
|---------|--------|------------|--------|
| **YouTube** | 新着動画 | `youtube_new_video` | ✅ v3.1.0+ |
| | Live開始 | `youtube_online` | ✅ v3.1.0+ |
| | アーカイブ | `youtube_archive` | ✅ v3.3.0+ |
| **Niconico** | 新着動画 | `nico_new_video` | ✅ v3.1.0+ |

## 改善点

### 📊 GUI 機能強化
- **複合フィルタリング UI**: タイトル・投稿状態・配信元・コンテンツタイプを同時に設定可能
- **統計情報**: 投稿数・未投稿数・配信元別集計（YouTube/ニコニコ）、過去7日間の投稿状況をリアルタイム表示
- **フィルタリング後の件数表示**: ステータスバーに「〇〇 件中 △△ 件を表示」と表示

### 📡 WebSub/PubSubHubbub 対応（v3.2.0 から継続）
YouTube の **2つの取得モード** に完全対応：

| モード | 方式 | 遅延 | ポーリング間隔 |
|--------|------|------|-------------|
| **Poll** | RSS ポーリング | 3-5分 | 10分（デフォルト） |
| **WebSub** | プッシュ通知 | 数十秒～数分 | 5分（デフォルト） |

- `YOUTUBE_FEED_MODE` で poll/websub を選択可能
- WebSub 用設定: `WEBSUB_CLIENT_ID`, `WEBSUB_CALLBACK_URL`, `WEBSUB_CLIENT_API_KEY` など

### 💾 バックアップ・復元機能（v3.2.0 から継続）
ZIP 形式での一括エクスポート/インポート：
- DB・テンプレート・設定ファイルを一括バックアップ
- API キー・パスワードの安全な除外オプション
- 復元時の自動バックアップで既存データを保護

## バグ修正
- Live 関連動画のキャッシュ有効期限チェック機構を修正（60分で期限切れに）
- YouTube API から取得した `scheduledStartTime` の JST 変換精度を向上
- フィルタリング時の日本語検索の精度改善
- YouTube アーカイブのテンプレート処理に対応（v3.3.0+）

## 既知の仕様・注意事項

### 📌 YouTube Live スケジュール予定時刻の変更通知なし
- **内容**: Live スケジュール枠の予定時刻が変更された場合、DB は更新されますが **Bluesky には通知投稿されません**
- **理由**: 投稿トリガーは `content_type` と `live_status` の状態遷移のみ監視
- **詳細**: [README.md](../README.md#-youtube-liveスケジュール枠の予定時刻変更仕様) を参照

### 📌 一括投稿スケジュール機能は v3.4.0+ で実装予定
- **現在状況**: 個別動画の予約投稿機能のみ実装
- **実装予定**: v3.4.0+ で複数動画の分散投稿スケジュール機能を追加

## アップデート方法

### v3.2.0 以前からのアップデート
```bash
# 1. リポジトリ更新
git pull origin main

# 2. 依存パッケージ確認（変更なし）
pip install -r v3/requirements.txt

# 3. バックアップ推奨
python -m v3.main_v3  # バックアップボタンで ZIP 出力

# 4. アプリケーション再起動
python -m v3.main_v3
```

### 設定変更（オプション）
```env
# v3.3.0 の新しい設定
PREVENT_DUPLICATE_POSTS=true  # 重複投稿防止（デフォルト: false）

# WebSub モード推奨（既存）
YOUTUBE_FEED_MODE=websub  # または poll
WEBSUB_CLIENT_ID=your_client_id
WEBSUB_CALLBACK_URL=https://your-domain.com/webhook
WEBSUB_CLIENT_API_KEY=your_api_key
```

## 動作環境
- **Python**: 3.9 以上
- **OS**: Windows / macOS / Linux
- **依存ライブラリ**: 変更なし（v3.2.0 と同じ）

## データベース
- **スキーマ変更**: なし（既存 DB はそのまま使用可能）
- **互換性**: v3.2.0 のデータベースはそのまま使用可能

## バージョン履歴（v3.3.x シリーズ）

### v3.3.3 (2026-01-07)
- 微細な改善と内部調整

### v3.3.0 (2025-12-19)
- 4条件複合フィルタリング実装
- 重複投稿防止オプション実装
- YouTube アーカイブテンプレート対応
- 統計情報の配信元別・日別分析に対応

## 今後の実装予定

### 🔜 v3.4.0+
- **一括投稿スケジュール機能**: 複数動画の分散投稿（15分間隔など）
  - Bluesky API レート制限対策
  - スパム防止

### 🔜 v4.0.0+
- **Web UI**: FastAPI + Jinja2 による設定管理・ダッシュボード
- **Twitch API 連携**: 配信開始・終了検知

詳細は [FUTURE_ROADMAP_v3.md](./v3/docs/References/FUTURE_ROADMAP_v3.md) を参照。

---

**引き続き、Streamnotify on Bluesky をご利用いただきありがとうございます！**

**サポート・バグ報告**: GitHub Issues を使用して、サポートやバグ報告をお願いします。
