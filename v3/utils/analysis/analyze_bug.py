#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
ä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯ä¸ç™ºã®æ ¹æœ¬åŸå› åˆ†æ
"""

print('=' * 90)
print('ğŸ”´ ä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯ä¸ç™ºã®æ ¹æœ¬åŸå› åˆ†æ')
print('=' * 90)
print()

# ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯
rss_published = '2025-12-23T19:30:44'
api_scheduled = '2025-12-28T18:00:00Z'
api_published = '2025-12-23T19:30:44Z'

print('ã€ ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼ ã€‘')
print('-' * 90)
print()
print('1ï¸âƒ£ RSS ã‹ã‚‰å–å¾—')
print(f'   RSS published_at = {rss_published}')
print()

print('2ï¸âƒ£ YouTube API ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æœ‰åŠ¹åŒ–æ™‚ã€ä»¥ä¸‹ã‚’å–å¾—')
print(f'   API - scheduledStartTime = {api_scheduled} â­ å„ªå…ˆåº¦æœ€é«˜')
print(f'   API - publishedAt = {api_published} (å„ªå…ˆåº¦3)')
print()

print('3ï¸âƒ£ youtube_rss.py - save_to_db() ã®ãƒ­ã‚¸ãƒƒã‚¯')
print()
print('   api_published_at = None')
print('   if scheduledStartTime:')
print('       api_published_at = scheduledStartTime  â† å®Ÿè¡Œã•ã‚Œã‚‹ï¼')
print('   elif actualStartTime:')
print('       ...')
print('   elif publishedAt:')
print('       api_published_at = publishedAt')
print()

print('âŒ ã—ã‹ã—å®Ÿéš›ã«ã¯...')
print('   DB ã«ç™»éŒ²ã•ã‚ŒãŸå€¤ = RSS published_at')
print('   ç†ç”±ï¼šinsert_video() ã§æ—¢å­˜å‹•ç”»ã‚’æ¤œå‡º â†’ False ã‚’è¿”ã™')
print()

print('4ï¸âƒ£ ä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯')
print()
print('   if api_published_at and api_published_at != video["published_at"]:')
print('       database.update_published_at(...)')
print()

print('âš ï¸ ã“ã“ãŒè‡´å‘½çš„ãªå•é¡Œï¼')
print(f'   å®Ÿéš›ã«æ¯”è¼ƒã•ã‚Œã¦ã„ã‚‹å€¤ï¼š')
print(f'   api_published_at = {api_published}')
print(f'   ï¼ˆscheduledStartTime ã§ã¯ãªã publishedAt ã«è½ã¡ã¦ã„ã‚‹ï¼‰')
print(f'   video["published_at"] = {rss_published}')
print()

api_clean = api_published.replace('Z', '')
rss_clean = rss_published

print('   å€¤ã®æ¯”è¼ƒï¼š')
print(f'   "{api_clean}" != "{rss_clean}"')
print()

if api_clean == rss_clean:
    print('   â†’ FALSEï¼ˆåŒã˜å€¤ï¼‰')
    print('   â†’ update_published_at() ãŒå‘¼ã°ã‚Œãªã„')
    print()
    print('   ğŸš¨ scheduledStartTime = 2025-12-28T18:00:00Z ãŒå®Œå…¨ã«æ¨ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼')

print()
print('=' * 90)
print('ã€ æœ¬æ¥ã®ã‚ã‚‹ã¹ããƒ­ã‚¸ãƒƒã‚¯ ã€‘')
print('=' * 90)
print()
print('å„ªå…ˆåº¦ãƒ«ãƒ¼ãƒ«ï¼š')
print('  1. API - scheduledStartTime (é…ä¿¡äºˆå®šæ™‚åˆ»)')
print('  2. API - actualStartTime (å®Ÿéš›é…ä¿¡é–‹å§‹æ™‚åˆ»)')
print('  3. API - publishedAt (å‹•ç”»å…¬é–‹æ™‚åˆ»)')
print('  4. RSS - published_at (RSSå€¤)')
print()
print('åˆå›ç™»éŒ²æ™‚ï¼š')
print(f'  âœ… final_published_at = {api_scheduled}')
print()
print('æ—¢å­˜å‹•ç”»ã®ä¸Šæ›¸ãï¼š')
print(f'  if {api_scheduled} != {rss_published}:')
print(f'      update_published_at()')
print('      â†’ ä¸Šæ›¸ãã•ã‚Œã‚‹ã¹ã')
print()

print('=' * 90)
print('ã€ ãƒã‚°ã®å½±éŸ¿ ã€‘')
print('=' * 90)
print()
print('ç¾åœ¨ï¼š')
print(f'  DB published_at = {rss_published}  âŒ å¤ã„å€¤')
print()
print('æœŸå¾…å€¤ï¼š')
print(f'  DB published_at = {api_scheduled}  âœ… é…ä¿¡äºˆå®šæ™‚åˆ»')
print()
print('BlueskyæŠ•ç¨¿æ™‚ï¼š')
print(f'  ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ä½¿ã‚ã‚Œã‚‹æ—¥æ™‚ = {rss_published}')
print(f'  æœ¬æ¥ã‚ã‚‹ã¹ãæ—¥æ™‚ = {api_scheduled}')
print()
print('çµæœï¼šæŠ•ç¨¿ã«é–“é•ã£ãŸé…ä¿¡æ—¥æ™‚ãŒè¡¨ç¤ºã•ã‚Œã‚‹')
print()

print('=' * 90)
print('ã€ æ ¹æœ¬åŸå›  ã€‘')
print('=' * 90)
print()
print('âŒ ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼š')
print('   1. RSS ã§æ¤œå‡º â†’ insert_video(..., published_at=RSSå€¤)')
print('   2. API ã‹ã‚‰ scheduledStartTime ã‚’å–å¾—')
print('   3. ä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯: if api_published_at != video["published_at"]:')
print('   4. ã—ã‹ã— API publishedAt == RSS published_at ãªã®ã§ä¸Šæ›¸ãä¸ç™º')
print('   5. scheduledStartTime ã¯æ¨ã¦ã‚‰ã‚Œã‚‹')
print()
print('âœ… ä¿®æ­£æ¡ˆï¼š')
print()
print('æ–¹æ¡ˆ1ï¼ˆæ¨å¥¨ï¼‰ï¼šRSSç™»éŒ²æ™‚ã«å„ªå…ˆåº¦ã‚’æ­£ã—ãé©ç”¨')
print('   final_published_at ã‚’ä»¥ä¸‹ã§æ±ºå®šï¼š')
print('   1ï¸âƒ£ API scheduledStartTime ã‚ã‚Œã°ä½¿ã†')
print('   2ï¸âƒ£ API actualStartTime ã‚ã‚Œã°ä½¿ã†')
print('   3ï¸âƒ£ API publishedAt ã‚ã‚Œã°ä½¿ã†')
print('   4ï¸âƒ£ RSS published_at ã‚’ä½¿ã†')
print()
print('æ–¹æ¡ˆ2ï¼šä¸Šæ›¸ããƒ­ã‚¸ãƒƒã‚¯ã‚’å¼·åŒ–')
print('   API scheduledStartTime ã¨ DB published_at ã‚’ç›´æ¥æ¯”è¼ƒ')
print('   ï¼ˆAPI publishedAt ã¨ã®æ¯”è¼ƒã§ã¯ãªãï¼‰')
print()
print('æ–¹æ¡ˆ3ï¼šåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã€Œæ­£ç¢ºãªé…ä¿¡äºˆå®šæ™‚åˆ»ã€ã‚’ä¿å­˜')
print('   published_atï¼ˆå…¬é–‹æ™‚åˆ»ï¼‰ã¨')
print('   scheduled_start_timeï¼ˆé…ä¿¡äºˆå®šæ™‚åˆ»ï¼‰ã‚’åˆ†é›¢')
print()

print('=' * 90)
