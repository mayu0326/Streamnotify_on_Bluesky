# Streamnotify on Bluesky - 将来実装機能ロードマップ

> **対象バージョン**: v3.1.0 時点
> **最終更新**: 2025-12-18

本ドキュメントは、**v3 の現在の実装設計**と**最初の構想ドキュメント**（`YouTube新着動画app（初期構想案）`）の
差異を整理し、将来実装すべき機能をロードマップとしてまとめたものです。

> **参考**
> - 現在の実装: [ARCHITECTURE_AND_DESIGN.md](../Technical/ARCHITECTURE_AND_DESIGN.md) 参照
> - 初期構想: `YouTube新着動画app（初期構想案）` 参照

***

## 1. 対応サービスの拡張

### v3 での実装
- (該当する実装なし)

### 将来実装（TwitchAPI連携プラグイン）

| サービス | 機能 | 優先度 | 実装方式 |
|---------|------|--------|---------|
| **Twitch** | 配信開始・終了検知 | 高 | TwitchAPI連携プラグイン（API または サードパーティ RSS） |

### 実装上の課題
- Twitch: 配信開始・終了の精度（RSS では検出困難）→ API 推奨
- YouTube 動画: API レート制限回避 → RSS+DBの利用でAPI消費を最小限に抑える設計が必須
- YouTube Live: API レート制限回避 → PubSubHubbub 優先設計

***

## 2. データ取得方式の拡張

### v3 での実装
- (該当する実装なし)

#### ニコニコ動画 - ユーザー名自動取得機能（v3.2.0以降）
- **概要**: ニコニコ RSS フィードから取得できないユーザー名を複数の方式で自動取得
- **優先順位**:
  1. RSS フィード（`<dc:creator>`）
  2. ニコニコ静画 API（`http://seiga.nicovideo.jp/api/user/info`）
  3. ユーザーページの og:title（Web スクレイピング）
  4. 環境変数 `NICONICO_USER_NAME`
  5. ユーザーID（最終フォールバック）
- **自動保存**: 取得されたユーザー名は `settings.env` に自動保存（2回目以降は API 呼び出し不要）
- **キャッシング**: プラグインインスタンス単位でのメモリキャッシング
- **メリット**: ユーザーによる手動設定が不要、API 呼び出しの最小化、多環境での動作対応

### 将来実装

#### Twitch API の導入
- **Twitch**: 配信状態、視聴者数、ゲームタイトル取得
- **優先度**: 高

#### PubSubHubbub サポート（PubSubHubbub連携プラグイン）
- **概要**: RSS の更新を RSS フィード発行元から**プッシュ通知**で受け取る
- **メリット**: リアルタイム検知、ポーリング不要、API 負荷低減
- **対応サービス**: YouTube（公式対応）、一部ブログプラットフォーム

***

## 3. 通知先の拡張

### v3 での実装
- **Bluesky のみ** (atproto ライブラリ)

### 将来実装

#### Discord 連携（動画投稿通知機能拡張プラグイン）
- **実装方式**: Webhook または Bot アカウント
- **機能**:
  - チャンネルへの自動投稿
  - 埋め込みメッセージ（Rich Embed）対応
  - ロール メンション、@everyone 対応（オプション）
- **テンプレート**: サービス別・イベント別に独立した投稿テンプレート

#### その他通知先（将来検討）
- Mastodon/misskey（ActivityPub 対応）

***

## 4. 投稿機能の拡張

- **重複投稿防止オプション**: `PREVENT_DUPLICATE_POSTS` 設定で同じ動画の再投稿を禁止
  - 誤った再投稿の防止、ユーザー体験向上
  - **実装予定**: v3

- **投稿テンプレートの動的変数追加**: `{{ random_emoji }}`、`{{ time_of_day }}` など
  - 投稿テンプレートの表現力向上、投稿の多様性確保
  - 実装例: `{{ current_date }}`、`{{ current_time }}`、`{{ day_of_week }}`
  - **実装予定**: v3

### v3 での実装（予定）
- **テンプレート処理**: Jinja2 形式（Twitch追加対応）
- **テンプレート種別**: 3 種類 追加
  - Twitch 配信開始通知
  - Twitch 配信終了通知
  - Twitch Raidテンプレート

#### テンプレート対応プラットフォーム（Live/Archive）

| プラットフォーム | ステータス | 理由 |
|:--|:--|:--|
| **Twitch** | 実装予定 | 2026年以降予定 |

### プラグインで実装済み（Bluesky 機能拡張プラグイン）

#### マルチテンプレート対応（追加予定）
- **テンプレート別分類**:
  - Twitch: 配信開始、配信終了
- **サービス・イベント別の自動選択**: イベント種別を自動判定し、該当テンプレートを適用

#### 画像添付機能の拡張
- **概要**: 配信プレビュー画像の自動ダウンロードと添付
- **対応サービス**: Twitch（配信プレビュー画像）
- **ファイル形式**: JPEG、PNG
- **サイズ制限**: 通知先ごとに最適化

#### リッチテキスト対応
- **Discord**: Rich Embed（色付きメッセージ、フィールド）
- **テンプレート側での制御**: 通知先ごとにマークアップ形式を自動変換

#### 投稿機能の追加拡張（v3以降に繰り下げ）
- **一括投稿スケジュール機能**: 複数動画を選択して分散投稿（15分ごと等）
  - メリット: Bluesky API ユーザーレート制限対策、スパム防止
  - 実装: GUI にスケジュール設定ダイアログを追加
  - **実装予定**: v3

***

## 5. インターフェースの拡張

### v3 での実装
- **CLI**: `python main_v3.py` で起動
- **フル機能版 GUI**（Tkinter）:
  - v2 にある全ての機能に加えて、以下の新機能を実装
    - **動画フィルタ・検索機能**
      - タイトル検索、配信元別フィルタ、投稿状態フィルタ
      - 大量動画時に対象動画を素早く見つけられる
      - フィルタ条件の保存機能
    - **重複投稿防止オプション**
      - `PREVENT_DUPLICATE_POSTS` 設定で同じ動画の再投稿を禁止
      - 投稿前に自動チェック、重複時は警告表示・投稿中止
      - ユーザーの誤操作防止、安心して運用可能

#### GUI 機能追加予定（v3以降に繰り下げ）
- **投稿成功率・統計情報の詳細表示** (v3予定)
  - Bluesky への投稿成否記録、エラー内容をデータベース保存
  - 統計情報：成功数、失敗数、エラーログなどの可視化
  - メリット: トラブルシューティング時に便利、運用監視向上

### 将来実装（補助機能プラグイン）

#### Web UI（FastAPI + Jinja2）
- **設定管理**:
  - サービス別の監視設定（チャンネル ID、ユーザー名、API キーなど）
  - 通知先設定（Bluesky、Discord）
  - ポーリング間隔、ログレベルなどの詳細設定
- **ダッシュボード**:
  - 直近の動画検知履歴（タイムライン表示）
  - 投稿成功/失敗状況
  - API 使用量の可視化
- **手動操作**:
  - 特定動画の強制投稿
  - 投稿済み状態の手動リセット
  - テンプレートのプレビュー・編集

#### Windows クライアント アプリケーション
- **技術スタック**: PyQt または Tkinter
- **機能**: Web UI と同等の機能を提供
- **メリット**: スタンドアロンで実行可能、常駐化が容易

#### ダークモード対応
- **対応範囲**: Web UI、Windows クライアント
- **テーマ切り替え**: UI 設定から選択可能

***

## 6. デプロイ・運用の拡張

### v3 での実装
- **実行方式**: CLI での手動起動
- **常駐化**: 別途 Windows タスクスケジューラ / systemd 対応が必要

#### 運用機能追加予定（v3以降に繰り下げ）
- **RSS フィード更新の手動トリガー** (v3予定)
  - GUI に「今すぐ更新」ボタン追加
  - テスト・デバッグ時に便利、ポーリング待機不要

### 将来実装（PubSubHubbub連携プラグイン、トンネル連携プラグイン）

#### トンネル連携（トンネル連携プラグイン）
- **PubSubHubbub/Twitch 用トンネル**:
  - Cloudflare Tunnel（推奨、無料）
  - ngrok（有料オプション）
  - localtunnel（シンプル）
- **自動セットアップ**: トンネル URL の自動生成・登録

***

## 7. 実装スケジュール

### 2026年1月以降に実装予定の機能

- **一括投稿スケジュール機能の最小版**
  - 複数動画を選択して分散投稿（15分ごと等）
  - メリット: Bluesky API ユーザーレート制限対策、スパム防止
  - **実装予定**: v3.4.0+

- **Twitch API 連携プラグイン全体**
  - 配信開始・終了検知、視聴者数、ゲームタイトル取得
  - **優先度**: 高

- **PubSubHubbub 連携プラグイン**
  - RSS の更新をプッシュ通知で受け取る
  - **メリット**: リアルタイム検知、ポーリング不要、API 負荷低減

- **Web UI の実装**
  - FastAPI + Jinja2 による設定管理、ダッシュボード、手動操作機能
  - **メリット**: ユーザーがブラウザから簡単に操作可能

***

## 8. データベースの拡張

### v3 での実装
- **SQLite のみ**（ローカルファイル）

#### バックアップ・復元機能（v3以降に繰り下げ）
- **概要**: テンプレート・設定も含めてエクスポート/インポート可能
- **対象**:
  - データベース（video_list.db）
  - テンプレート設定
  - settings.env 設定（API キー除外オプション）
- **メリット**: 環境移行時・トラブル時の復旧が簡単
- **実装方式**: ZIP形式でまとめてエクスポート、インポート時に検証
- **実装予定**: v3.4.0+

### 将来実装（データベース連携プラグイン）

| データベース | 用途 | 優先度 |
|------------|------|--------|
| **PostgreSQL** | マルチユーザー環境、大規模運用 | 中 |
| **MySQL** | VPS/クラウド環境での標準選択肢 | 中 |
| **MongoDB** | ドキュメント型、スケーラビリティ重視 | 低 |
| **Firebase** | バックアップ、クラウド同期 | 低 |

***

## 9. ロギング・監視の拡張

### v3 での実装
- **基本的なログ出力**: コンソール、ファイル（`logs/app.log`）
- **ログレベル**: INFO(デバッグモードOFF)、DEBUG(デバッグモードON)
- **最大ログサイズ**: 10MB
- **バックアップ数**: 5 世代

#### ログ設定拡張プラグインで対応する機能
- **ログレベルの細分化**:ロガー単位でのログレベル設定
- **指定可能な値**: DEBUG, INFO, WARNING, ERROR, CRITICAL
- **ログフォーマットのカスタマイズ**: 出力先の選択
- **ログの保存期間設定**: 14日分

### 将来実装
#### 監視・アラート機能
- **Sentry 連携**: エラーの自動レポート
- **Discord への通知**: 重大エラー発生時の即座の通知
- **ヘルスチェック**: API エンドポイント（`/health`）の公開

#### メトリクス収集
- **Prometheus 互換メトリクス**: 投稿数、API レスポンス時間など
- **Grafana ダッシュボード**: リアルタイム可視化

***

## 10. セキュリティ強化

### v3 での実装
- **認証情報の管理**: `settings.env` ファイル（Git 管理外）
- **基本的なバリデーション**: 設定値のチェック

### 将来実装

#### 認証情報の暗号化
- **暗号化方式**: AES-256
- **鍵管理**: マスターパスワード方式 または ハードウェア セキュリティ キー対応

#### アクセス制御（Web UI）
- **ユーザー認証**: パスワード、OAuth2
- **ロールベースアクセス制御（RBAC）**: 管理者、オペレータ、閲覧者

#### API キーの安全な取得
- **初期セットアップウィザード**: ユーザーに対話形式で API キー取得をガイド
- **トークンの自動更新**: 期限切れトークンの自動更新

***

## 11. 実装フェーズと優先度

### Phase 1（v1）
- [✅] **YouTube新着動画投稿**: RSS 方式での新着動画検知・投稿
- [✅] **基本的なCLIインターフェース**: 動作モード選択、ログ出力
- [✅] **SQLiteデータベース**: 動画管理、投稿履歴 保存
- [✅] **Bluesky投稿機能**: atproto ライブラリを使用した投稿機能
- [✅] **GUI**	: 最小限機能のみを実装済み（動画一覧表示、投稿実行）
- [✅] **ロギング設定**: appとerror ログのみ（RotatingFileHandler）
- [✅] **バージョン管理**: app_version.py（v0.1.0）

### Phase 2（v2 - v2.3.0 で完了予定）
- [✅] **YouTubeAPI連携プラグイン**: 複数チャンネル対応、詳細情報取得
- [✅] **Bluesky 機能拡張プラグイン**: 画像添付、投稿テンプレート拡張
- [✅] **ニコニコ動画プラグイン**: RSS フィード監視、投稿対応
- [✅] **RSS ポーリング方式での動画検知**: 定期的なフィードチェック
- [✅] **ユーザー名自動取得・自動保存機能**（v2.3.0実装完了）
- [✅] **ログ設定拡張プラグイン**: 詳細ログ設定
- [✅] **GUI 動画削除機能**: DB からの完全削除（ツールバー・右クリックメニュー対応）
- [✅] **YouTubeLiveプラグイン完成**: ライブ開始/終了自動検知、テンプレート自動適用（v2.3.0で完成）
- [✅] **Asset マネージャー統合**: プラグイン導入時にテンプレート・画像を自動配置（v2.3.0で実装）
- [✅] **テンプレートシステム（Jinja2）**: サービス別・イベント別のテンプレート対応（v2.3.0で実装）
- [✅] **Rich Text Facet**: URL・ハッシュタグのリンク化機能（v2.3.0で実装）
- [✅] **削除済み動画キャッシュ**: 削除動画の追跡・除外リスト管理（v2.3.0で実装）
- [✅] **画像処理パイプライン**: サムネイル自動取得・リサイズ・最適化・キャッシング（v2.3.0で実装）

### Phase 3（v3 で実装完了した機能）
- [✅] **GUIフィルタ・検索機能**: タイトル検索、投稿状態フィルタ、配信元フィルタ、種類フィルタ（2025-12-19 実装）
- [✅] **重複投稿防止オプション**: `PREVENT_DUPLICATE_POSTS` 設定で同じ動画の再投稿を禁止（2025-12-19 実装）
- [✅] **RSS手動更新ボタン**: GUI から即座にRSS更新をトリガー
- [✅] **投稿テンプレート動的変数**: `{{ current_date }}`, `{{ random_emoji }}` など
- [✅] **GUI機能拡張**: 統計詳細表示、クイック投稿テンプレート

### Phase 3.4（v3から繰り下げた機能）
- [ ] **一括投稿スケジュール機能**: 複数動画の分散投稿（15分間隔など）
- [ ] **バックアップ・復元機能**: DB・テンプレート・設定の一括エクスポート/インポート


#### 新規機能
- [ ] **PubSubHubbub連携プラグイン**: リアルタイム通知
- [ ] **TwitchAPI連携プラグイン**: Twitch 対応
- [ ] **トンネル通信プラグイン**: トンネルサービス連携
- [ ] **Web UI**: 基本的な設定管理画面
- [ ] **Webhook**: PubSubHubbub/Twitch EventSubの実装・統合
- [ ] **動画、Live、設定、キャッシュ**: それぞれ別で管理するように実装

### Phase 4（v4以降）
- [ ] **データベース連携プラグイン**: PostgreSQL/MySQL 対応
- [ ] **補助機能プラグイン**: Windowsクライアントアプリケーション、ダークモード/テーマ切替
- [ ] **監視・アラート機能**: Sentry/Prometheus連携、エラー通知
- [ ] **プラグインのホットリロード・動的有効化/無効化**

### Phase 5（v5以降）
- [ ] Mastodon/Bluesky 他 ActivityPub サービス対応（複数通知先への統一実装）


***

## 11. 参考資料・検討事項

### 技術参考
- [YouTube Data API v3](https://developers.google.com/youtube/v3)
- [PubSubHubbub 仕様](https://pubsubhubbub.appspot.com/)
- [Twitch API ドキュメント](https://dev.twitch.tv/docs/api)
- [Discord Webhook ガイド](https://discord.com/developers/docs/resources/webhook)
- [LINE Messaging API](https://developers.line.biz/en/services/messaging-api/)

### 検討が必要な項目
1. **API レート制限**: YouTube Data API 10,000 ユニット/日 の制約下での効率的な実装
2. **トンネルセキュリティ**: PubSubHubbub 導入時の HTTPS 化、署名検証
3. **マルチユーザー**: v3 は単一ユーザー前提（複数チャンネル監視は不可）→ 将来の拡張時に検討
4. **オフラインキャッシング**: トンネル障害時の動作保証

## Asset管理と拡張時のファイル追加

- 全サービス・プラグイン用テンプレート/画像は `Asset/` ディレクトリに保管
- プラグイン導入時に必要なファイルのみ本番ディレクトリに自動コピー
- 追加済みファイルはプラグイン削除後も残る
- 将来拡張時は Asset に新規テンプレート/画像を追加し、導入時に自動コピー
