# WebSub/RSS Ã— YouTubeVideoClassifier Ã— LiveModule çµ±åˆå®Ÿè£…

**å®Ÿè£…æ—¥**: 2026å¹´1æœˆ3æ—¥
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.4.0+
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Ÿè£…å®Œäº†ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼æ¸ˆã¿

---

## å®Ÿè£…å†…å®¹

WebSub ã¨ RSS ã‹ã‚‰å±Šã„ãŸ YouTube å‹•ç”»ã«ã¤ã„ã¦ã€ãƒ©ã‚¤ãƒ–é–¢é€£ï¼ˆschedule/live/completed/archiveï¼‰ã®å ´åˆã¯ LiveModule ã«æ¸¡ã—ã¦ JSTå¤‰æ›ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šã‚’è¡Œã†ã‚ˆã†ä¿®æ­£ã—ã¾ã—ãŸã€‚

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

1. **youtube_core/youtube_rss.py** - save_to_db ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£
2. **youtube_core/youtube_websub.py** - save_to_db ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£
3. **main_v3.py** - save_to_db ã®å‘¼ã³å‡ºã—éƒ¨åˆ†ã‚’ä¿®æ­£

---

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
WebSub/RSS ã‹ã‚‰å‹•ç”»ã‚’å–å¾—
    â†“
YouTubeRSS.save_to_db() / YouTubeWebSub.save_to_db()
    â†“
æ–°è¦å‹•ç”»ã‚’ DB ã«ç™»éŒ²
    â†“
classifier = YouTubeVideoClassifier.classify_video(video_id)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Liveé–¢é€£                      â”‚ é€šå¸¸å‹•ç”»/ãƒ—ãƒ¬ãƒŸã‚¢   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ schedule/live/completed/      â”‚ video/premiere     â”‚
â”‚ archive                       â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                                  â†“
LiveModule.                        æ—¢å­˜å‡¦ç†
register_from_classified(result)   ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰
    â†“
- DBç™»éŒ²ï¼ˆcontent_type, live_statusï¼‰
- JSTå¤‰æ›
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š
```

---

## ä¿®æ­£å†…å®¹ã®è©³ç´°

### 1. youtube_rss.py - save_to_db ãƒ¡ã‚½ãƒƒãƒ‰

**ç½²åã®å¤‰æ›´**:
```python
def save_to_db(self, database, classifier=None, live_module=None) -> tuple:
    """
    Returns:
        (ä¿å­˜ã•ã‚ŒãŸå‹•ç”»æ•°, Liveç™»éŒ²æ•°) ã®ã‚¿ãƒ—ãƒ«
    """
```

**æ–°è¦å‹•ç”»å‡¦ç†**:
- æ–°è¦å‹•ç”»ãŒ Live é–¢é€£ã‹ã©ã†ã‹ã‚’ `YouTubeVideoClassifier.classify_video()` ã§åˆ†é¡
- `result["type"]` ãŒ `["schedule", "live", "completed", "archive"]` ã®ã„ãšã‚Œã‹ãªã‚‰
- `LiveModule.register_from_classified(result)` ã‚’å‘¼ã³å‡ºã—

**æ—¢å­˜å‹•ç”»å‡¦ç†**:
- `channel_name` ãŒç©ºã€ã¾ãŸã¯ live é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`live_status`ï¼‰ãŒæœªè¨­å®šã®å ´åˆ
- åˆ†é¡ã¨ç™»éŒ²ã‚’å†å®Ÿè¡Œã—ã¦æƒ…å ±ã‚’è£œå®Œ

### 2. youtube_websub.py - save_to_db ãƒ¡ã‚½ãƒƒãƒ‰

youtube_rss.py ã¨åŒã˜ä¿®æ­£å†…å®¹ã‚’é©ç”¨

### 3. main_v3.py - RSS/WebSub ã®å‘¼ã³å‡ºã—

```python
# WebSub ãƒ¢ãƒ¼ãƒ‰
saved_count, live_count = yt_websub.save_to_db(
    db,
    classifier=classifier,
    live_module=live_module
)
logger.info(f"[YouTube] WebSub DBä¿å­˜å®Œäº†: {saved_count} ä»¶ï¼ˆLiveç™»éŒ²: {live_count} ä»¶ï¼‰")

# RSS ãƒ¢ãƒ¼ãƒ‰
saved_count, live_count = yt_rss.save_to_db(
    db,
    classifier=classifier,
    live_module=live_module
)
logger.info(f"[YouTube] RSS DBä¿å­˜å®Œäº†: {saved_count} ä»¶ï¼ˆLiveç™»éŒ²: {live_count} ä»¶ï¼‰")
```

---

## ç‰¹å¾´

### âœ… è‡ªå‹•åˆ†é¡ãƒ»ç™»éŒ²

- YouTubeVideoClassifier ã§å‹•ç”»ã‚¿ã‚¤ãƒ—ã‚’è‡ªå‹•åˆ†é¡
- Liveé–¢é€£ã¯ LiveModule ã«è‡ªå‹•ç™»éŒ²
- é€šå¸¸å‹•ç”»ã¯æ—¢å­˜å‡¦ç†ã§ç¶šè¡Œ

### âœ… æƒ…å ±è£œå®Œæ©Ÿèƒ½

- æ—¢å­˜å‹•ç”»ã§ã‚‚æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚Œã°å†åˆ†é¡ãƒ»ç™»éŒ²
- `channel_name` ãŒç©ºã®å ´åˆã¯ API ã‹ã‚‰è£œå®Œ
- `live_status` ãŒæœªè¨­å®šã® Liveé–¢é€£å‹•ç”»ã¯æ›´æ–°

### âœ… JSTå¤‰æ›å¯¾å¿œ

- RSS/WebSub ã®æ—¥æ™‚ã¯ UTC â†’ JST ã«å¤‰æ›
- YouTubeAPI ã® `scheduledStartTime` ã‚‚ JST å¤‰æ›
- DB ã«ä¿å­˜ã•ã‚Œã‚‹å…¨ã¦ã®æ—¥æ™‚ã¯ JST å½¢å¼

### âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- åˆ†é¡å¤±æ•—æ™‚ã¯æ—¢å­˜å‡¦ç†ã§ç¶šè¡Œï¼ˆæŠ•ç¨¿å‡¦ç†ã‚’ä¸­æ–­ã—ãªã„ï¼‰
- æƒ…å ±è£œå®Œå¤±æ•—æ™‚ã‚‚ãƒ­ã‚°å‡ºåŠ›ã—ã¦ç¶šè¡Œ
- ä¾‹å¤–ç™ºç”Ÿæ™‚ã‚‚å®‰å…¨ã«ã‚¹ã‚­ãƒƒãƒ—

---

## ãƒ­ã‚°å‡ºåŠ›ä¾‹

```
[YouTube] RSS DBä¿å­˜å®Œäº†: 5 ä»¶ï¼ˆLiveç™»éŒ²: 2 ä»¶ï¼‰
âœ… YouTubeå‹•ç”»åˆ†é¡å™¨ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ
ğŸ¬ Liveé–¢é€£å‹•ç”»ã‚’åˆ†é¡: ã€‡ã€‡ãƒ©ã‚¤ãƒ–é…ä¿¡ (type=schedule)
âœ… Liveå‹•ç”»ã‚’ LiveModule ã«ç™»éŒ²ã—ã¾ã—ãŸ: schedule
ğŸ”„ æ—¢å­˜å‹•ç”»ã®æƒ…å ±è£œå®Œã‚’å®Ÿè¡Œ: â–³â–³å‹•ç”»
âœ… æ—¢å­˜ Liveå‹•ç”»ã®æƒ…å ±ã‚’è£œå®Œã—ã¾ã—ãŸ: live
âœ… Live ãƒãƒ¼ãƒªãƒ³ã‚°å®Œäº†: 1 ä»¶ã‚’å‡¦ç†ã—ã¾ã—ãŸ
```

---

## æˆ»ã‚Šå€¤ã®å¤‰æ›´

### æ—§ï¼ˆv3.3.0ä»¥å‰ï¼‰
```python
saved_count = yt_rss.save_to_db(db)  # int
```

### æ–°ï¼ˆv3.4.0+ï¼‰
```python
saved_count, live_count = yt_rss.save_to_db(db, classifier, live_module)  # tuple
```

---

## äº’æ›æ€§

- **å¾Œæ–¹äº’æ›æ€§**: å‘¼ã³å‡ºã—å…ƒã§ `saved_count, live_count` ã®å½¢å¼ã‚’ä½¿ç”¨
- **ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**: `classifier` ã¨ `live_module` ã¯ None ã§ã‚‚å‹•ä½œï¼ˆåˆ†é¡ã‚¹ã‚­ãƒƒãƒ—ï¼‰
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰**: YouTube API ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æœªå°å…¥æ™‚ã‚‚å‹•ä½œ

---

## ãƒ†ã‚¹ãƒˆç¢ºèªäº‹é …

1. âœ… RSS ã‹ã‚‰å–å¾—ã—ãŸé€šå¸¸å‹•ç”»ãŒ DB ã«ç™»éŒ²ã•ã‚Œã‚‹
2. âœ… RSS ã‹ã‚‰å–å¾—ã—ãŸ Liveé–¢é€£å‹•ç”»ãŒ LiveModule ã«ç™»éŒ²ã•ã‚Œã‚‹
3. âœ… WebSub ã‹ã‚‰å–å¾—ã—ãŸå‹•ç”»ã‚‚åŒæ§˜ã«åˆ†é¡ãƒ»ç™»éŒ²ã•ã‚Œã‚‹
4. âœ… æ—¢å­˜å‹•ç”»ã®æƒ…å ±è£œå®ŒãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆchannel_name ãŒç©ºã®å ´åˆï¼‰
5. âœ… åˆ†é¡å¤±æ•—æ™‚ã‚‚æ—¢å­˜å‡¦ç†ã§ç¶šè¡Œã•ã‚Œã‚‹
6. âœ… æ—¥æ™‚ãŒ JST å½¢å¼ã§ DB ã«ä¿å­˜ã•ã‚Œã‚‹

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- âœ… YouTubeVideoClassifier ã®åˆæœŸåŒ–
- âœ… LiveModule ã®åˆæœŸåŒ–
- âœ… youtube_rss.py save_to_db ã®ä¿®æ­£
- âœ… youtube_websub.py save_to_db ã®ä¿®æ­£
- âœ… main_v3.py ã®å‘¼ã³å‡ºã—éƒ¨åˆ†ä¿®æ­£
- âœ… ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯

---

**å®Ÿè£…è€…**: GitHub Copilot
**æ¤œè¨¼æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- youtube_core/youtube_rss.py âœ…
- youtube_core/youtube_websub.py âœ…
- main_v3.py âœ…
