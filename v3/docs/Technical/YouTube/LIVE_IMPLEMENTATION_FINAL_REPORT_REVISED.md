# âœ… YouTube Live å‹•ç”»åˆ†é¡ãƒ»ç™»éŒ²æ©Ÿèƒ½ - æœ€çµ‚å®Ÿè£…å ±å‘Šæ›¸ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

**å®Ÿè£…å®Œäº†æ—¥**: 2025-01-15
**æœ€çµ‚æ›´æ–°**: 2026-01-03ï¼ˆutils_v3.py çµ±åˆï¼‰
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.3.0+
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œæˆãƒ»ãƒ†ã‚¹ãƒˆæ¤œè¨¼æ¸ˆã¿

---

## ğŸ“Š å®Ÿè£…æ¦‚è¦

### ğŸ¯ å®Ÿè£…ç›®æ¨™
Live é–¢é€£å‹•ç”»ï¼ˆschedule/live/completed/archiveï¼‰ã‚’ YouTubeVideoClassifier ã§åˆ†é¡ã—ã€
LiveModule çµŒç”±ã§ DB ã«ç™»éŒ²ã™ã‚‹éš›ã«ã€**ãƒãƒ£ãƒ³ãƒãƒ«åã¨ç’°å¢ƒå¤‰æ•° TIMEZONE ã§æŒ‡å®šã•ã‚ŒãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ™‚åˆ»**ã‚’ç¢ºå®Ÿã«ä¿å­˜ã™ã‚‹ã€‚

### âœ… å®Œæˆã—ãŸæ©Ÿèƒ½

#### 1ï¸âƒ£ YouTubeVideoClassifier - channel_name æŠ½å‡º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/youtube_core/youtube_video_classifier.py`

```python
# Line 207: YouTube API snippet ã‹ã‚‰ãƒãƒ£ãƒ³ãƒãƒ«åã‚’æŠ½å‡º
channel_name = snippet.get("channelTitle", "")

# Line 276: è¿”å´è¾æ›¸ã«è¿½åŠ 
return {
    ...
    "channel_name": channel_name,  # â˜… æ–°è¦
    "published_at": published_at,  # æ—¢å­˜ï¼ˆUTCå½¢å¼ï¼‰
    ...
}
```

**å‹•ä½œç¢ºèª**: âœ… æ­£å¸¸ã«æŠ½å‡ºãƒ»è¿”å´

#### 2ï¸âƒ£ LiveModule - format_datetime_filter ã‚’ç”¨ã„ãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/plugins/youtube/live_module.py`

```python
# Line 104-120: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›ï¼ˆç’°å¢ƒå¤‰æ•° TIMEZONE ã«å¾“ã†ï¼‰
if published_at:
    try:
        from utils_v3 import format_datetime_filter
        # format_datetime_filter ã¯ ISO 8601 å½¢å¼ã‚’ç’°å¢ƒå¤‰æ•° TIMEZONE ã§æŒ‡å®šã•ã‚ŒãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã«å¤‰æ›
        published_at_converted = format_datetime_filter(published_at, fmt="%Y-%m-%dT%H:%M:%S")
        logger.debug(f"ğŸ“¡ published_at ã‚’å¤‰æ›: {published_at} â†’ {published_at_converted}")
        published_at = published_at_converted
    except Exception as e:
        logger.warning(f"âš ï¸ published_at ã®å¤‰æ›å¤±æ•—ã€å…ƒã®å€¤ã‚’ä½¿ç”¨: {e}")
```

**ç‰¹å¾´**:
- âœ… æ—¢å­˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ `format_datetime_filter` ã‚’æ´»ç”¨
- âœ… ç’°å¢ƒå¤‰æ•° `TIMEZONE` ã§æŸ”è»Ÿã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æŒ‡å®šå¯èƒ½
- âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
- âœ… æŒ‡å®šå¯èƒ½: `Asia/Tokyo`ï¼ˆJSTï¼‰ã€`UTC`ã€ãã®ä»– pytz å¯¾å¿œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…ï¼ˆå¤‰æ›å¤±æ•—æ™‚ã‚‚å‡¦ç†ç¶™ç¶šï¼‰

**å‹•ä½œç¢ºèª**: âœ… æ­£å¸¸ã«å¤‰æ›ï¼ˆãƒ†ã‚¹ãƒˆåˆæ ¼ï¼‰

| å…¥åŠ›ï¼ˆUTCï¼‰ | ç’°å¢ƒ | å‡ºåŠ› | ãƒ†ã‚¹ãƒˆçµæœ |
|:--|:--|:--|:--|
| 2025-01-15T14:00:00Z | systemï¼ˆJSTç’°å¢ƒï¼‰ | 2025-01-15T23:00:00 | âœ… åˆæ ¼ |
| 2025-01-15T20:00:00Z | systemï¼ˆJSTç’°å¢ƒï¼‰ | 2025-01-16T05:00:00 | âœ… åˆæ ¼ |
| 2025-01-15T00:00:00Z | systemï¼ˆJSTç’°å¢ƒï¼‰ | 2025-01-15T09:00:00 | âœ… åˆæ ¼ |

#### 3ï¸âƒ£ RSS/WebSub - Live vs é€šå¸¸å‹•ç”»ã®åˆ†å²
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/youtube_core/youtube_rss.py` / `youtube_core/youtube_websub.py`

```python
# åˆ†é¡çµæœã«åŸºã¥ã„ã¦å‡¦ç†ã‚’åˆ†å²
video_type = result.get("type")

if video_type in ["schedule", "live", "completed", "archive"]:
    # Live é–¢é€£: LiveModule ã®ã¿ã§å‡¦ç†
    live_module.register_from_classified(result)
else:
    # é€šå¸¸å‹•ç”»: insert_video() ã®ã¿ã§å‡¦ç†
    is_new = database.insert_video(...)
```

**åŠ¹æœ**: âœ… åŒã˜ video_id ã«å¯¾ã—ã¦äºŒé‡ç™»éŒ²ãŒç™ºç”Ÿã—ãªã„

#### 4ï¸âƒ£ Database - å®Œå…¨ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/database.py`

```python
def insert_video(
    self,
    video_id,
    title,
    video_url,
    published_at,  # â˜… ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›æ¸ˆã¿
    channel_name="",  # â˜… ãƒãƒ£ãƒ³ãƒãƒ«å
    ...
):
    # INSERT å®Ÿè¡Œ
    cursor.execute("""
        INSERT INTO videos (
            video_id, title, video_url, published_at, channel_name,
            thumbnail_url, content_type, live_status, is_premiere, source
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    """, (video_id, title, video_url, published_at, channel_name, ...))
```

**å‹•ä½œç¢ºèª**: âœ… å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ­£ã—ã DB ã«ä¿å­˜ã•ã‚Œã‚‹

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ¤œè¨¼çµæœ

### âœ… ãƒ†ã‚¹ãƒˆ 1: format_datetime_filter ã® JST å¤‰æ›
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/test_jst_conversion.py`
**å®Ÿè¡Œæ—¥**: 2025-01-15

```
âœ… é€šå¸¸ã®é…ä¿¡äºˆå®š
   å…¥åŠ›ï¼ˆUTCï¼‰: 2025-01-15T14:00:00Z
   å‡ºåŠ›ï¼ˆJSTï¼‰: 2025-01-15T23:00:00
   æœŸå¾…å€¤ï¼š    2025-01-15T23:00:00
   âœ… å¤‰æ›æˆåŠŸ

âœ… æ·±å¤œé…ä¿¡
   å…¥åŠ›ï¼ˆUTCï¼‰: 2025-01-15T20:00:00Z
   å‡ºåŠ›ï¼ˆJSTï¼‰: 2025-01-16T05:00:00
   æœŸå¾…å€¤ï¼š    2025-01-16T05:00:00
   âœ… å¤‰æ›æˆåŠŸ

âœ… æœé…ä¿¡
   å…¥åŠ›ï¼ˆUTCï¼‰: 2025-01-15T00:00:00Z
   å‡ºåŠ›ï¼ˆJSTï¼‰: 2025-01-15T09:00:00
   æœŸå¾…å€¤ï¼š    2025-01-15T09:00:00
   âœ… å¤‰æ›æˆåŠŸ
```

**çµæœ**: âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼ˆ3/3ï¼‰

### âœ… ãƒ†ã‚¹ãƒˆ 2: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“
**ãƒ•ã‚¡ã‚¤ãƒ«**: `v3/test_data_flow.py`ï¼ˆæ”¹è¨‚ç‰ˆï¼‰
**å®Ÿè¡Œæ—¥**: 2026-01-03

```
âœ… ã‚¹ãƒ†ãƒƒãƒ— 1: YouTubeVideoClassifier åˆ†é¡çµæœ
   âœ… Classifier ãŒ channel_name ã‚’è¿”ã™

âœ… ã‚¹ãƒ†ãƒƒãƒ— 2: published_at ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›
   ä½¿ç”¨é–¢æ•°: format_datetime_filterï¼ˆfrom utils_v3ï¼‰
   å…¥åŠ›ï¼ˆUTCï¼‰: 2025-01-15T14:00:00Z
   å‡ºåŠ›: 2025-01-15T23:00:00
   âœ… ç’°å¢ƒå¤‰æ•° TIMEZONE ã«å¾“ã£ã¦å¤‰æ›

âœ… ã‚¹ãƒ†ãƒƒãƒ— 3-5: database.insert_video() ã¨ DB ä¿å­˜
   âœ… å…¨10ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ­£ã—ãæ§‹æˆã•ã‚Œã‚‹
   âœ… channel_name ãŒ DB ã«ä¿å­˜ã•ã‚Œã‚‹
   âœ… published_at ãŒå¤‰æ›æ¸ˆã¿å½¢å¼ã§ä¿å­˜ã•ã‚Œã‚‹
```

**çµæœ**: âœ… å…¨ã‚¹ãƒ†ãƒƒãƒ—æˆåŠŸï¼ˆ5/5ï¼‰

### âœ… ãƒ†ã‚¹ãƒˆ 3: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¤œè¨¼
**å®Ÿè¡Œæ—¥**: 2026-01-03

```bash
python -m py_compile \
  youtube_core/youtube_video_classifier.py \
  plugins/youtube/live_module.py \
  youtube_core/youtube_rss.py \
  youtube_core/youtube_websub.py \
  utils_v3.py
```

**çµæœ**: âœ… å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸï¼ˆæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãªã—ï¼‰

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YouTube API / RSS / WebSub                                  â”‚
â”‚ â†’ video_id, snippet (title, channelTitle, publishedAt, ...) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YouTubeVideoClassifier.classify_video(video_id)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ channel_name â† snippet["channelTitle"]  â˜… æ–°è¦æŠ½å‡º   â”‚   â”‚
â”‚ â”‚ published_at â† snippet["publishedAt"] (UTC)           â”‚   â”‚
â”‚ â”‚ video_type â† snippet/liveStreamingDetails ã®åˆ†æ     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ è¿”å´è¾æ›¸: {                                                 â”‚
â”‚    "success": True,                                         â”‚
â”‚    "video_id": "xxxxx",                                     â”‚
â”‚    "type": "live",                                          â”‚
â”‚    "channel_name": "ãƒ†ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«",  â˜… æ–°è¦              â”‚
â”‚    "published_at": "2025-01-15T14:00:00Z",  (UTC)           â”‚
â”‚    ...                                                      â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
    [video_type IN         [video_type IN
     Liveé–¢é€£]              é€šå¸¸å‹•ç”»]
         â”‚                       â”‚
         â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ LiveModule          â”‚    â”‚ database         â”‚
    â”‚ register_from_      â”‚    â”‚ insert_video()   â”‚
    â”‚ classified(result)  â”‚    â”‚                  â”‚
    â”‚                     â”‚    â”‚ é€šå¸¸å‹•ç”»å‡¦ç†      â”‚
    â”‚ â˜… format_datetime.. â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚   _filter ã§å¤‰æ›:   â”‚
    â”‚ published_at        â”‚
    â”‚ (UTC) â†’ TIMEZONE    â”‚
    â”‚                     â”‚
    â”‚ channel_name ã‚‚      â”‚
    â”‚ æŠ½å‡ºã—ã¦æ¸¡ã™        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ database.insert_video(             â”‚
    â”‚    video_id: "xxxxx",              â”‚
    â”‚    channel_name: "ãƒãƒ£ãƒ³ãƒãƒ«å",    â”‚ â˜… DBä¿å­˜
    â”‚    published_at: "2025-01-15T23:00",â”‚ â˜… TIMEZONEå½¢å¼
    â”‚    content_type: "live",           â”‚
    â”‚    live_status: "live",            â”‚
    â”‚    ...                             â”‚
    â”‚ )                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SQLite ä¿å­˜å®Œäº†            â”‚
    â”‚                            â”‚
    â”‚ video_id  | xxxxx          â”‚
    â”‚ channel_name | ãƒãƒ£ãƒ³ãƒãƒ«å â”‚ âœ…
    â”‚ published_at | 2025-01...  â”‚ âœ… (TIMEZONE)
    â”‚ content_type | live        â”‚ âœ…
    â”‚ live_status  | live        â”‚ âœ…
    â”‚ ...                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| # | ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œç•ªå· | ä¿®æ­£å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|:--|:--|:--|:--|:--|
| 1 | youtube_core/youtube_video_classifier.py | 207, 276 | channel_name æŠ½å‡ºãƒ»è¿”å´ | âœ… å®Œæˆ |
| 2 | plugins/youtube/live_module.py | 104-120 | format_datetime_filter ã‚’ç”¨ã„ãŸã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ› | âœ… å®Œæˆ |
| 3 | youtube_core/youtube_rss.py | 231-283 | Live vs é€šå¸¸å‹•ç”»ã®åˆ†å²å‡¦ç† | âœ… å®Œæˆ |
| 4 | youtube_core/youtube_websub.py | é¡ä¼¼ | Live vs é€šå¸¸å‹•ç”»ã®åˆ†å²å‡¦ç† | âœ… å®Œæˆ |

---

## âœ¨ å‹•ä½œä¾‹

### å…¥åŠ›ä¾‹: YouTube API å¿œç­”

```json
{
  "snippet": {
    "title": "ã€ãƒ©ã‚¤ãƒ–é…ä¿¡ã€‘Streamnotify v3.3.0 ãƒ‡ãƒ¢",
    "channelTitle": "é…ä¿¡ãƒ†ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«",
    "publishedAt": "2025-01-15T14:00:00Z",
    "thumbnails": { ... }
  },
  "liveStreamingDetails": {
    "actualStartTime": "2025-01-15T14:00:00Z"
  }
}
```

### å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—

**ã‚¹ãƒ†ãƒƒãƒ— 1: åˆ†é¡**
```
VideoClassifier.classify_video() å®Ÿè¡Œ
  â†“
video_type = "live"
channel_name = "é…ä¿¡ãƒ†ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«"
published_at = "2025-01-15T14:00:00Z" (UTC)
```

**ã‚¹ãƒ†ãƒƒãƒ— 2: LiveModule ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›**
```
format_datetime_filter("2025-01-15T14:00:00Z")
  â†“ ç’°å¢ƒå¤‰æ•° TIMEZONE ã«å¾“ã†
  â”œâ”€ TIMEZONE=Asia/Tokyo ã®å ´åˆ
  â”‚  â†’ "2025-01-15T23:00:00" (JST)
  â””â”€ TIMEZONE=UTC ã®å ´åˆ
     â†’ "2025-01-15T14:00:00" (UTC)
```

**ã‚¹ãƒ†ãƒƒãƒ— 3: database.insert_video() å®Ÿè¡Œ**
```sql
INSERT INTO videos (
  video_id, title, video_url, channel_name,
  published_at, content_type, live_status, ...
) VALUES (
  'xxxxx', 'ã€ãƒ©ã‚¤ãƒ–é…ä¿¡ã€‘Streamnotify v3.3.0 ãƒ‡ãƒ¢',
  'https://www.youtube.com/watch?v=xxxxx',
  'é…ä¿¡ãƒ†ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«',  â† channel_name
  '2025-01-15T23:00:00',   â† published_at (TIMEZONEå½¢å¼)
  'live',                  â† content_type
  'live',                  â† live_status
  ...
)
```

### DB ä¿å­˜çµæœ

| video_id | title | channel_name | published_at | content_type | live_status |
|:--|:--|:--|:--|:--|:--|
| xxxxx | ã€ãƒ©ã‚¤ãƒ–é…ä¿¡ã€‘Streamnotify... | é…ä¿¡ãƒ†ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ« | 2025-01-15T23:00:00 | live | live |

âœ… **channel_name** ã¨ **published_at (TIMEZONEå½¢å¼)** ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- âœ… YouTubeVideoClassifier ãŒ channel_name ã‚’è¿”ã™
- âœ… published_at ãŒ YouTube API (UTC) ã‹ã‚‰æ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹
- âœ… **LiveModule ã§ format_datetime_filter ã‚’ä½¿ç”¨**ã—ã¦ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›
- âœ… **ç’°å¢ƒå¤‰æ•° TIMEZONE ã«å¾“ã£ã¦æŸ”è»Ÿã«å¤‰æ›**
- âœ… ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›ãŒæ­£ç¢ºï¼ˆãƒ†ã‚¹ãƒˆåˆæ ¼ 3/3ï¼‰
- âœ… database.insert_video() ã«æ­£ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œã‚‹
- âœ… DB ã« channel_name ãŒä¿å­˜ã•ã‚Œã‚‹
- âœ… DB ã« published_at (TIMEZONEå½¢å¼) ãŒä¿å­˜ã•ã‚Œã‚‹
- âœ… Live vs é€šå¸¸å‹•ç”»ãŒå®Œå…¨ã«åˆ†é›¢ã•ã‚Œã‚‹
- âœ… äºŒé‡ç™»éŒ²ãŒç™ºç”Ÿã—ãªã„
- âœ… ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸï¼ˆæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¤œè¨¼æˆåŠŸ

---

## ğŸš€ å®Ÿé‹ç”¨ã§ã®è¨­å®š

### settings.env ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æŒ‡å®š

```env
# â˜… ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šï¼ˆJST ã‚’æŒ‡å®šï¼‰
TIMEZONE=Asia/Tokyo

# ã¾ãŸã¯ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ä½¿ç”¨
TIMEZONE=system  ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

# ãã®ä»–ã®æŒ‡å®šä¾‹
# TIMEZONE=UTC
# TIMEZONE=America/New_York
# TIMEZONE=Europe/London
```

### å‹•ä½œç¢ºèª

å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
ğŸ“¡ published_at ã‚’å¤‰æ›: 2025-01-15T14:00:00Z â†’ 2025-01-15T23:00:00
ğŸ“ Liveå‹•ç”»ã‚’LiveModuleã§ç™»éŒ²ã—ã¾ã™
ğŸ“ Liveå‹•ç”»ã‚’LiveModuleã§ç™»éŒ²å®Œäº†: xxxxx
```

### DB ã‚¯ã‚¨ãƒªã§æ¤œè¨¼

```sql
SELECT video_id, channel_name, published_at, content_type, live_status
FROM videos
WHERE content_type IN ('live', 'schedule', 'archive', 'completed')
LIMIT 5;
```

æœŸå¾…ã•ã‚Œã‚‹çµæœï¼š
- `channel_name`: å®Ÿéš›ã®ãƒãƒ£ãƒ³ãƒãƒ«åãŒè¡¨ç¤ºã•ã‚Œã‚‹
- `published_at`: TIMEZONE æŒ‡å®šã®å½¢å¼ã§è¡¨ç¤ºã•ã‚Œã‚‹
- `content_type`: 'live', 'schedule', 'archive', 'completed' ã®ã„ãšã‚Œã‹
- `live_status`: 'live', 'upcoming', 'completed' ã®ã„ãšã‚Œã‹

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [utils_v3.py](v3/utils_v3.py) - `format_datetime_filter` é–¢æ•°
- [YouTubeVideoClassifier](v3/youtube_core/youtube_video_classifier.py) - åˆ†é¡ãƒ­ã‚¸ãƒƒã‚¯
- [LiveModule](v3/plugins/youtube/live_module.py) - Live å‡¦ç†
- [Database](v3/database.py) - DB ã‚¹ã‚­ãƒ¼ãƒ

---

## ğŸ’¾ ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

å®Ÿè£…ã«ä¼´ã„ä½œæˆãƒ»æ›´æ–°ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼š
- `v3/test_jst_conversion.py` - JST å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
- `v3/test_data_flow.py` - ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®æ¤œè¨¼ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
python v3/test_jst_conversion.py
python v3/test_data_flow.py
```

---

**å®Ÿè£…å®Œäº†æ—¥**: 2025-01-15
**æœ€çµ‚æ›´æ–°**: 2026-01-03
**æ”¹è¨‚**: utils_v3.py ã® format_datetime_filter é–¢æ•°ã‚’çµ±åˆ

ğŸ‰ **YouTube Live å‹•ç”»åˆ†é¡ãƒ»ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…ãŒå®Œå…¨ã«å®Œäº†ã—ã¾ã—ãŸï¼**

---

## å¤‰æ›´ã‚µãƒãƒªãƒ¼ï¼ˆ2026-01-03 æ”¹è¨‚ï¼‰

### å¤‰æ›´å†…å®¹
- âœ… **LiveModule ã® JST å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ”¹å–„**
  - æ‰‹å‹•å®Ÿè£…ã® JST å¤‰æ› â†’ `format_datetime_filter` é–¢æ•°ã«çµ±åˆ
  - ç’°å¢ƒå¤‰æ•° `TIMEZONE` ã§æŸ”è»Ÿã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æŒ‡å®šå¯èƒ½ã«
  - pytz å¯¾å¿œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å…¨ã¦åˆ©ç”¨å¯èƒ½ã«

### ãƒ¡ãƒªãƒƒãƒˆ
1. **ã‚³ãƒ¼ãƒ‰å“è³ª**: æ—¢å­˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å†åˆ©ç”¨ï¼ˆDRYåŸå‰‡ï¼‰
2. **æŸ”è»Ÿæ€§**: JST é™å®šã§ã¯ãªãã€ä»»æ„ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã«å¯¾å¿œ
3. **ä¿å®ˆæ€§**: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ãŒ utils_v3.py ã«ä¸€å…ƒåŒ–
4. **æ‹¡å¼µæ€§**: ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚‚ `format_datetime_filter` ã‚’å†åˆ©ç”¨å¯èƒ½

### ãƒ†ã‚¹ãƒˆçµæœ
- âœ… format_datetime_filter ã«ã‚ˆã‚‹å¤‰æ›ãŒæ­£ç¢ºã«å‹•ä½œ
- âœ… ç’°å¢ƒå¤‰æ•° TIMEZONE ã«å¾“ã£ã¦é©åˆ‡ã«å¤‰æ›
- âœ… å…¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸ
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¤œè¨¼æˆåŠŸ
